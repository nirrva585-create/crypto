<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Strict Crypto Signals â€¢ Alerts</title>
  <style>
    :root {
      --bg: #0a0e17;
      --card: #111827;
      --text: #d1d5db;
      --green: #10b981;
      --red: #ef4444;
    }
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 12px 16px;
      background: var(--bg);
      color: var(--text);
      font-size: 0.95rem;
    }
    header {
      text-align: center;
      padding: 12px;
      background: var(--card);
      border-radius: 8px;
      margin-bottom: 12px;
    }
    h1 {
      margin: 0;
      font-size: 1.35rem;
      font-weight: 600;
    }
    #status {
      color: #9ca3af;
      font-size: 0.85rem;
      margin-top: 4px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
      margin: 12px 0;
    }
    input, button {
      padding: 8px 12px;
      border-radius: 6px;
      background: #1f2937;
      border: 1px solid #374151;
      color: white;
      font-size: 0.9rem;
    }
    button {
      background: #3b82f6;
      border: none;
      cursor: pointer;
    }
    button:hover { opacity: 0.92; }
    .alert-toggle {
      background: #374151;
    }
    .alert-toggle.active {
      background: #10b981;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border-radius: 8px;
      overflow: hidden;
      font-size: 0.9rem;
    }
    th, td {
      padding: 9px 10px;
      text-align: center;
      border-bottom: 1px solid #374151;
    }
    th {
      background: #0f172a;
      font-weight: 500;
      color: #9ca3af;
    }
    tr:hover {
      background: rgba(16,185,129,0.08);
    }
    .strong-buy { background: rgba(16,185,129,0.22); color: var(--green); font-weight: 700; }
    .buy       { color: var(--green); font-weight: 600; }
    .sell      { color: var(--red);   font-weight: 600; }
    .strong-sell { background: rgba(239,68,68,0.22); color: var(--red); font-weight: 700; }
    .neutral   { color: #9ca3af; font-style: italic; }
  </style>
</head>
<body>

<header>
  <h1>Strict Crypto Signals + Alerts</h1>
  <div id="status">Loading real-time data...</div>
</header>

<div class="controls">
  <input type="text" id="search" placeholder="Search coin...">
  <button id="refresh">â†» Manual</button>
  <button id="alert-toggle" class="alert-toggle">ðŸ”” Alerts ON</button>
</div>

<table id="table">
  <thead>
    <tr>
      <th>Coin</th>
      <th>Price</th>
      <th>24h</th>
      <th>Signal</th>
      <th>Entry â†’ TP / SL</th>
    </tr>
  </thead>
  <tbody id="tbody"></tbody>
</table>

<script>
const COINGECKO = 'https://api.coingecko.com/api/v3';
let previousStrongSignals = new Set(); // track previous strong signals to detect new ones
let alertsEnabled = true;

document.getElementById('alert-toggle').onclick = function() {
  alertsEnabled = !alertsEnabled;
  this.textContent = alertsEnabled ? 'ðŸ”” Alerts ON' : 'ðŸ”• Alerts OFF';
  this.className = 'alert-toggle ' + (alertsEnabled ? 'active' : '');
};

async function loadData() {
  const status = document.getElementById('status');
  status.textContent = 'Scanning strong movers...';

  try {
    const btcRes = await fetch(`${COINGECKO}/coins/markets?vs_currency=usd&ids=bitcoin`);
    const btc = (await btcRes.json())[0] || {};
    const btc24h = btc.price_change_percentage_24h || 0;

    const res = await fetch(
      `${COINGECKO}/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=100&page=1&sparkline=false&price_change_percentage=24h`
    );
    const coins = await res.json();

    const tbody = document.getElementById('tbody');
    tbody.innerHTML = '';

    let currentStrongSignals = new Set();

    let ranked = [];

    coins.forEach(c => {
      if ((c.market_cap || 0) < 200_000_000 || (c.total_volume || 0) < 30_000_000) return;

      const ch24 = c.price_change_percentage_24h || 0;
      const volRatio = (c.total_volume || 0) / (c.market_cap || 1);
      const rel = ch24 - btc24h;

      let signal = 'NEUTRAL';
      let cls = 'neutral';

      // Very strict strong signals
      if (ch24 > 10 && volRatio > 4 && rel > 6) {
        signal = 'STRONG BUY';
        cls = 'strong-buy';
        currentStrongSignals.add(`${c.symbol}-STRONG BUY`);
      } else if (ch24 > 6 && volRatio > 2.5 && rel > 3) {
        signal = 'BUY';
        cls = 'buy';
      } else if (ch24 < -10 && volRatio > 4 && rel < -6) {
        signal = 'STRONG SELL';
        cls = 'strong-sell';
        currentStrongSignals.add(`${c.symbol}-STRONG SELL`);
      } else if (ch24 < -6 && volRatio > 2.5 && rel < -3) {
        signal = 'SELL';
        cls = 'sell';
      }

      if (signal === 'NEUTRAL') return;

      const entry = c.current_price;
      const tp = (entry * 1.18).toFixed(4);
      const sl = (entry * 0.91).toFixed(4);

      ranked.push({
        name: c.name,
        symbol: c.symbol.toUpperCase(),
        image: c.image,
        price: entry,
        ch24: ch24.toFixed(2),
        signal,
        cls,
        entry: entry.toFixed(4),
        tp,
        sl
      });
    });

    // Detect new strong signals and alert
    if (alertsEnabled) {
      currentStrongSignals.forEach(sig => {
        if (!previousStrongSignals.has(sig)) {
          const [symbol, sigType] = sig.split('-');
          alert(`NEW ${sigType} ALERT!\n${symbol} just triggered a strong signal!`);
          // Simple beep sound
          new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQAAAAA=').play();
        }
      });
      previousStrongSignals = currentStrongSignals;
    }

    // Sort strongest first
    ranked.sort((a,b) => {
      const sa = a.signal.includes('STRONG') ? 1000 : a.signal.includes('BUY') || a.signal.includes('SELL') ? 500 : 0;
      const sb = b.signal.includes('STRONG') ? 1000 : b.signal.includes('BUY') || b.signal.includes('SELL') ? 500 : 0;
      return sb - sa || Math.abs(b.ch24) - Math.abs(a.ch24);
    });

    ranked.forEach(c => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td style="text-align:left">
          <img src="${c.image}" width="20" height="20" style="vertical-align:middle; margin-right:6px; border-radius:50%;">
          ${c.name} (${c.symbol})
        </td>
        <td>$${c.price.toLocaleString(undefined,{minimumFractionDigits:2,maxFractionDigits:6})}</td>
        <td>${c.ch24}%</td>
        <td class="${c.cls}">${c.signal}</td>
        <td>$${c.entry} â†’ $${c.tp} / $${c.sl}</td>
      `;
      tbody.appendChild(tr);
    });

    status.textContent = `Updated: ${new Date().toLocaleTimeString()} â€¢ Auto-refresh every 10 seconds`;
  } catch (err) {
    status.textContent = 'Error loading data â€¢ Retrying in 10s...';
  }
}

// Auto-refresh every 10 seconds
setInterval(loadData, 10000);

document.getElementById('refresh').onclick = loadData;

document.getElementById('search').oninput = function() {
  const term = this.value.trim().toLowerCase();
  document.querySelectorAll('#tbody tr').forEach(row => {
    row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
  });
};

window.onload = loadData;
</script>
</body>
</html>
